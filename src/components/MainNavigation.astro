---
// cspell:words impressum

import { useTranslations } from '@/utils/i18n';
import { getLocalizedRoute } from '@/utils/routes';

const ui = {
	en: {
		home: 'Home',
		about: "That's me",
		services: 'Services',
		stats: 'Stats',
		testimonials: 'Testimonials',
		contact: 'Contact',
		imprint: 'Imprint',
		privacy: 'Privacy',
	},
	de: {
		home: 'Startseite',
		about: 'Ãœber mich',
		services: 'Dienstleistungen',
		stats: 'Statistiken',
		testimonials: 'Meinungen',
		contact: 'Kontakt',
		imprint: 'Impressum',
		privacy: 'Datenschutz',
	},
};

const lang = Astro.url.pathname.split('/')[1] === 'de' ? 'de' : 'en';
const langPrefix = lang === 'de' ? '/de' : '/';

const t = useTranslations(ui, lang);

const currentPath = Astro.url.pathname;
const isHomePage = currentPath === '/' || currentPath === '/de';
const isImprintPage = lang !== 'de' ? currentPath.includes('/imprint') : currentPath.includes('/impressum');
const isPrivacyPage = lang !== 'de' ? currentPath.includes('/privacy') : currentPath.includes('/datenschutz');
---

<nav class="main-navigation" data-is-home={isHomePage}>
	<ul>
		<li><a href={`${langPrefix}#root`}>{t("home")}</a></li>
		<li><a href={`${langPrefix}#about`}>{t("about")}</a></li>
		<li><a href={`${langPrefix}#services`}>{t("services")}</a></li>
		<li><a href={`${langPrefix}#stats`}>{t("stats")}</a></li>
		<li><a href={`${langPrefix}#testimonials`}>{t("testimonials")}</a></li>
		<li><a href={`${langPrefix}#contact-section`}>{t("contact")}</a></li>
		<li><hr /></li>
		<li>
			<a
				href={getLocalizedRoute(lang, "imprint")}
				class:list={[{ active: isImprintPage }]}>{t("imprint")}</a
			>
		</li>
		<li>
			<a
				href={getLocalizedRoute(lang, "privacy")}
				class:list={[{ active: isPrivacyPage }]}>{t("privacy")}</a
			>
		</li>
	</ul>
</nav>

<script>
	const nav = document.querySelector(".main-navigation");
	const isHomePage = nav?.getAttribute("data-is-home") === "true";

	if (isHomePage) {
		const sections = [
			"root",
			"about",
			"services",
			"stats",
			"testimonials",
			"contact-section",
		];

		function updateActiveNav() {
			const scrollPosition = window.scrollY + window.innerHeight / 2; // Offset for better UX

			let currentSection = sections[0];

			for (const sectionId of sections) {
				const section = document.getElementById(sectionId);
				if (section && section.offsetTop <= scrollPosition) {
					currentSection = sectionId;
				}
			}

			// Update active class on navigation links (href's contain hash like /#about or /de#about)
			const navLinks = document.querySelectorAll(
				'.main-navigation a[href*="#"]',
			);
			navLinks.forEach((link) => {
				const href = link.getAttribute("href");
				const linkSection = href?.split("#")[1];

				if (linkSection === currentSection) {
					link.classList.add("active");
				} else {
					link.classList.remove("active");
				}
			});
		}

		// Run on scroll with throttling for performance
		let ticking = false;
		window.addEventListener("scroll", () => {
			if (!ticking) {
				window.requestAnimationFrame(() => {
					updateActiveNav();
					ticking = false;
				});
				ticking = true;
			}
		});

		// Run on page load
		updateActiveNav();
	}
</script>

<style>
	.main-navigation {
		ul {
			margin: 0 0 2rem 0;
			padding: 0;
			text-align: right;

			@media (min-width: 700px) {
				margin: 0;
			}

			li {
				margin: 0 0 0.625rem 0;
				padding: 0;
				font-weight: 500;
				font-size: 0.75rem;
				letter-spacing: 1px;
				text-transform: uppercase;
				list-style: none;

				@media (min-width: 700px) {
					font-size: 1rem;
				}

				&.active a,
				a.active {
					color: var(--primary);

					&::after {
						transform: scaleX(1);
						visibility: visible;
					}
				}

				a {
					position: relative;
					padding: 10px 0;
					color: var(--white);
					text-decoration: none;
					transition: var(--transition-duration-fast);

					&:hover {
						color: var(--primary);

						&::after {
							transform: scaleX(1);
							visibility: visible;
						}
					}

					&::after {
						position: absolute;
						right: 0;
						bottom: 1.06rem;
						left: -1.5rem;
						width: 1rem;
						height: 1px;
						background-color: var(--primary);
						transform: scaleX(0);
						visibility: hidden;
						transition: all var(--transition-duration-fast)
							cubic-bezier(0.175, 0.885, 0.32, 1.275);
						content: "";
					}
				}
			}
		}
	}
</style>
