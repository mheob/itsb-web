---
import '@fontsource/geist-sans/400.css';
import '@fontsource/geist-sans/700.css';

import Analytics from '@vercel/analytics/astro';
import Head from '@/components/Head.astro';
import NavigationToggle from '@/components/NavigationToggle.astro';
import ScrollTopButton from '@/components/ScrollTopButton.astro';

import '@/styles/global.css';

const lang = Astro.url.pathname.split('/')[1] === 'de' ? 'de' : 'en';
---

<html lang={lang}>
	<head>
		<Head />
		<script is:inline>
			(function () {
				const STORAGE_KEY = "preferred-language";
				const currentLang = window.location.pathname.split("/")[1] === "de" ? "de" : "en";

				let preferredLang = localStorage.getItem(STORAGE_KEY);
				if (!preferredLang) {
					const browserLang = navigator.language?.split("-")[0] || "en";
					preferredLang = browserLang === "de" ? "de" : "en";
					localStorage.setItem(STORAGE_KEY, preferredLang);
				}

				if (preferredLang !== currentLang) {
					const newPath =
						preferredLang === "de"
							? "/de" + window.location.pathname
							: window.location.pathname.replace(/^\/de/, "") || "/";
					window.location.replace(newPath + window.location.hash);
				}
			})();
		</script>
	</head>
	<body>
		<div id="root">
			<NavigationToggle />
			<slot />
			<ScrollTopButton />
		</div>
		<Analytics />
	</body>
</html>

<style>
	#root {
		position: relative;
		width: 100%;
		overflow: hidden;
		min-height: 100vh;
	}
</style>
